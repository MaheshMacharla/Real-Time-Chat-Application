{"ast":null,"code":"import _Math$sign from \"@babel/runtime-corejs3/core-js-stable/math/sign\";\nimport _Date$now from \"@babel/runtime-corejs3/core-js-stable/date/now\";\n\n/* eslint no-magic-numbers: [\"error\", { \"ignore\": [0, 1, 1.5, 5] }] */\nimport PropTypes from 'prop-types';\nimport { useCallback, useLayoutEffect, useRef } from 'react';\nfunction squareStepper(current, to) {\n  var sign = _Math$sign(to - current);\n  var step = Math.sqrt(Math.abs(to - current));\n  var next = current + step * sign;\n  if (sign > 0) {\n    return Math.min(to, next);\n  }\n  return Math.max(to, next);\n}\nfunction step(from, to, stepper, index) {\n  var next = from;\n  for (var i = 0; i < index; i++) {\n    next = stepper(next, to);\n  }\n  return next;\n}\nvar SpineTo = function SpineTo(_ref) {\n  var name = _ref.name,\n    onEnd = _ref.onEnd,\n    target = _ref.target,\n    value = _ref.value;\n  var animator = useRef();\n  var animate = useCallback(function (name, from, to, index) {\n    var start = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : _Date$now();\n    if (to === '100%' || typeof to === 'number') {\n      cancelAnimationFrame(animator.current);\n      animator.current = requestAnimationFrame(function () {\n        if (target) {\n          var toNumber = to === '100%' ? target.scrollHeight - target.offsetHeight : to;\n          var nextValue = step(from, toNumber, squareStepper, (_Date$now() - start) / 5);\n          if (Math.abs(toNumber - nextValue) < 1.5) {\n            nextValue = toNumber;\n          }\n          target[name] = nextValue;\n          if (toNumber === nextValue) {\n            onEnd && onEnd(true);\n          } else {\n            animate(name, from, to, index + 1, start);\n          }\n        }\n      });\n    }\n  }, [animator, onEnd, target]);\n  var handleCancelAnimation = useCallback(function () {\n    cancelAnimationFrame(animator.current);\n    onEnd && onEnd(false);\n  }, [onEnd]);\n  useLayoutEffect(function () {\n    animate(name, target[name], value, 1);\n    if (target) {\n      target.addEventListener('pointerdown', handleCancelAnimation, {\n        passive: true\n      });\n      target.addEventListener('wheel', handleCancelAnimation, {\n        passive: true\n      });\n      return function () {\n        target.removeEventListener('pointerdown', handleCancelAnimation);\n        target.removeEventListener('wheel', handleCancelAnimation);\n        cancelAnimationFrame(animator.current);\n      };\n    }\n    return function () {\n      return cancelAnimationFrame(animator.current);\n    };\n  }, [animate, animator, handleCancelAnimation, name, target, value]);\n  return false;\n};\nSpineTo.propTypes = {\n  name: PropTypes.string.isRequired,\n  onEnd: PropTypes.func,\n  target: PropTypes.any.isRequired,\n  value: PropTypes.oneOfType([PropTypes.number, PropTypes.oneOf(['100%'])]).isRequired\n};\nexport default SpineTo;","map":{"version":3,"sources":["../../src/SpineTo.js"],"names":["PropTypes","useCallback","useLayoutEffect","useRef","squareStepper","current","to","sign","step","Math","sqrt","abs","next","min","max","from","stepper","index","i","SpineTo","name","onEnd","target","value","animator","animate","start","cancelAnimationFrame","requestAnimationFrame","toNumber","scrollHeight","offsetHeight","nextValue","handleCancelAnimation","addEventListener","passive","removeEventListener","propTypes","string","isRequired","func","any","oneOfType","number","oneOf"],"mappings":"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","sourcesContent":["/* eslint no-magic-numbers: [\"error\", { \"ignore\": [0, 1, 1.5, 5] }] */\n\nimport PropTypes from 'prop-types';\nimport { useCallback, useLayoutEffect, useRef } from 'react';\n\nfunction squareStepper(current, to) {\n  const sign = Math.sign(to - current);\n  const step = Math.sqrt(Math.abs(to - current));\n  const next = current + step * sign;\n\n  if (sign > 0) {\n    return Math.min(to, next);\n  }\n\n  return Math.max(to, next);\n}\n\nfunction step(from, to, stepper, index) {\n  let next = from;\n\n  for (let i = 0; i < index; i++) {\n    next = stepper(next, to);\n  }\n\n  return next;\n}\n\nconst SpineTo = ({ name, onEnd, target, value }) => {\n  const animator = useRef();\n\n  const animate = useCallback(\n    (name, from, to, index, start = Date.now()) => {\n      if (to === '100%' || typeof to === 'number') {\n        cancelAnimationFrame(animator.current);\n\n        animator.current = requestAnimationFrame(() => {\n          if (target) {\n            const toNumber = to === '100%' ? target.scrollHeight - target.offsetHeight : to;\n            let nextValue = step(from, toNumber, squareStepper, (Date.now() - start) / 5);\n\n            if (Math.abs(toNumber - nextValue) < 1.5) {\n              nextValue = toNumber;\n            }\n\n            target[name] = nextValue;\n\n            if (toNumber === nextValue) {\n              onEnd && onEnd(true);\n            } else {\n              animate(name, from, to, index + 1, start);\n            }\n          }\n        });\n      }\n    },\n    [animator, onEnd, target]\n  );\n\n  const handleCancelAnimation = useCallback(() => {\n    cancelAnimationFrame(animator.current);\n    onEnd && onEnd(false);\n  }, [onEnd]);\n\n  useLayoutEffect(() => {\n    animate(name, target[name], value, 1);\n\n    if (target) {\n      target.addEventListener('pointerdown', handleCancelAnimation, { passive: true });\n      target.addEventListener('wheel', handleCancelAnimation, { passive: true });\n\n      return () => {\n        target.removeEventListener('pointerdown', handleCancelAnimation);\n        target.removeEventListener('wheel', handleCancelAnimation);\n        cancelAnimationFrame(animator.current);\n      };\n    }\n\n    return () => cancelAnimationFrame(animator.current);\n  }, [animate, animator, handleCancelAnimation, name, target, value]);\n\n  return false;\n};\n\nSpineTo.propTypes = {\n  name: PropTypes.string.isRequired,\n  onEnd: PropTypes.func,\n  target: PropTypes.any.isRequired,\n  value: PropTypes.oneOfType([PropTypes.number, PropTypes.oneOf(['100%'])]).isRequired\n};\n\nexport default SpineTo;\n"]},"metadata":{},"sourceType":"module"}